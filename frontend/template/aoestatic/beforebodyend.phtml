<?php /* @var $this Aoe_Static_Block_Beforebodyend */?>
<?php if( ! Mage::registry('aoestatic')) return; ?>
<script type="text/javascript">
//<![CDATA[
    if(aoeStaticUrl) {
        <?php if('prototype' == Mage::helper('aoestatic')->getJslib()): ?>
        document.observe('dom:loaded', function(){
            $$('.placeholder').each(function(el) {
              aoeStatic.blocks[el.id] = el.readAttribute('rel');
            });
            new Ajax.Request(aoeStaticUrl, {
                parameters: {json: Object.toJSON(aoeStatic)},
                evalJSON: 'force',
                onSuccess: function(response) {
                    var data = response.responseJSON;
                    $H(data.blocks).each(function(block){
                        var el = $(block.key);
                        if(el) { el.replace(block.value); }
                    });
                    Mage.Cookies.set('frontend', data.sid, null, '/', null, false);
                }
            });
        });
        <?php elseif('jquery' == Mage::helper('aoestatic')->getJslib()): ?>
        jQuery(document).ready(function($) {
            $('.placeholder').each(function() {
                aoeStatic.blocks[$(this).attr('id')] = $(this).attr('rel');
            });
            // E.T. phone home
            $.get(
                aoeStaticUrl,
                aoeStatic,
                function (data) {
                    for(var id in data.blocks) {
                        $('#' + id).html(data.blocks[id]);
                    }
                    $.cookie('frontend', data.sid, { path: '/' });
                },
                'json'
            );
        });
        <?php endif; ?>
    }
//]]>
</script>
